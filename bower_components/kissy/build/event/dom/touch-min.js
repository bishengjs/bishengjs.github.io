/*
Copyright 2013, KISSY v1.41
MIT Licensed
build time: Dec 13 19:28
*/
KISSY.add("event/dom/touch/handle-map",[],function(){return{}});KISSY.add("event/dom/touch/single-touch",[],function(e){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!==this.requiredTouchCount)return!1;a=this.lastTouches=a.touches;this.lastXY={pageX:a[0].pageX,pageY:a[0].pageY}},onTouchMove:e.noop,onTouchEnd:e.noop};return a});
KISSY.add("event/dom/touch/tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(d){d.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k=i.Object;e.extend(h,f,{onTouchMove:function(d){var a=this.lastXY,d=d.changedTouches[0];if(!d||5<Math.abs(d.pageX-a.pageX)||5<Math.abs(d.pageY-a.pageY))return!1},onTouchEnd:function(d){var a=d.changedTouches[0],b=d.target,n=new k({type:"tap",
target:b,currentTarget:b});e.mix(n,{pageX:a.pageX,pageY:a.pageY,originalEvent:d.originalEvent,which:1,touch:a});i.fire(b,"tap",n);if(n.isDefaultPrevented())i.on(b,"click",{fn:c,once:1})}});g.tap={handle:new h};return h});
KISSY.add("event/dom/touch/swipe",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(b,a,f){var g=a.changedTouches[0],q=g.pageX-b.startX,m=g.pageY-b.startY,j=Math.abs(q),r=Math.abs(m);if(f){if(b.isVertical&&b.isHorizontal){if(5>Math.max(j,r))return;r>j?b.isHorizontal=0:b.isVertical=0}}else if(b.isVertical&&r<l&&(b.isVertical=0),b.isHorizontal&&j<l)b.isHorizontal=0;if(b.isHorizontal)q=0>q?"left":"right";else if(b.isVertical)q=0>m?"up":"down",j=r;else return!1;i.fire(a.target,
f?d:k,{originalEvent:a.originalEvent,pageX:g.pageX,pageY:g.pageY,which:1,touch:g,direction:q,distance:j,duration:(a.timeStamp-b.startTime)/1E3})}function h(){}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./single-touch"),k="swipe",d="swiping",l=50;e.extend(h,f,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!==b.type.indexOf("mouse")&&
b.preventDefault()},onTouchMove:function(b){var a=b.changedTouches[0],d=a.pageY-this.startY,a=Math.abs(a.pageX-this.startX),d=Math.abs(d);if(1E3<b.timeStamp-this.startTime)return!1;this.isVertical&&35<a&&(this.isVertical=0);this.isHorizontal&&35<d&&(this.isHorizontal=0);return c(this,b,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:c(this,a,0)}});g[k]=g[d]={handle:new h};return h});
KISSY.add("event/dom/touch/double-tap",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var i=this.lastEndTime,d=a.timeStamp,e=a.target,
b=a.changedTouches[0],c=d-this.startTime;this.lastEndTime=d;if(i&&(c=d-i,300>c)){this.lastEndTime=0;g.fire(e,"doubleTap",{touch:b,duration:c/1E3});return}c=d-this.startTime;300<c?g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3}):this.singleTapTimer=setTimeout(function(){g.fire(e,"singleTap",{touch:b,pageX:b.pageX,which:1,pageY:b.pageY,duration:c/1E3})},300)}});h.singleTap=h.doubleTap={handle:new c};return c});
KISSY.add("event/dom/touch/multi-touch",["dom"],function(e,a){function c(){}var h=a("dom");c.prototype={constructor:c,requiredTouchCount:2,onTouchStart:function(a){var i=this.requiredTouchCount,c=a.touches.length;c===i?this.start():c>i&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:e.noop,getCommonTarget:function(a){var c=a.touches,a=c[0].target,c=c[1].target;if(a===c||h.contains(a,c))return a;for(;;){if(h.contains(c,
a))return c;c=c.parentNode}"getCommonTarget error!"},end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return c});
KISSY.add("event/dom/touch/pinch",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch");e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var d=a.touches;if(0<d[0].pageX&&0<d[0].pageY&&0<d[1].pageX&&0<d[1].pageY){var c,b=d[0],f=d[1];c=b.pageX-f.pageX;b=b.pageY-f.pageY;c=Math.sqrt(c*c+b*b);this.lastTouches=d;this.isStarted?i.fire(this.target,"pinch",
e.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,d=this.target=this.getCommonTarget(a),i.fire(d,"pinchStart",e.mix(a,{distance:c,scale:1})))}}},fireEnd:function(a){i.fire(this.target,"pinchEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.pinchStart=g.pinchEnd={handle:f};g.pinch={handle:f,setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/tap-hold",["./handle-map","event/dom/base","./single-touch"],function(e,a){function c(){}var h=a("./handle-map"),g=a("event/dom/base"),i=a("./single-touch");e.extend(c,i,{onTouchStart:function(a){if(!1===c.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){var c=a.touches[0];g.fire(a.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(e.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},
onTouchEnd:function(){clearTimeout(this.timer)}});h.tapHold={handle:new c};return c});
KISSY.add("event/dom/touch/rotate",["./handle-map","event/dom/base","./multi-touch"],function(e,a){function c(){}function h(a){2===a.touches.length&&a.preventDefault()}var g=a("./handle-map"),i=a("event/dom/base"),f=a("./multi-touch"),k=180/Math.PI;e.extend(c,f,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,b=c[0],f=c[1],g=this.lastAngle,b=Math.atan2(f.pageY-b.pageY,f.pageX-b.pageX)*k;if(void 0!==g){var f=Math.abs(b-g),h=(b+360)%360,q=(b-360)%360;Math.abs(h-g)<f?b=h:Math.abs(q-g)<f&&
(b=q)}this.lastTouches=c;this.lastAngle=b;this.isStarted?i.fire(this.target,"rotate",e.mix(a,{angle:b,rotation:b-this.startAngle})):(this.isStarted=!0,this.startAngle=b,this.target=this.getCommonTarget(a),i.fire(this.target,"rotateStart",e.mix(a,{angle:b,rotation:0})))}},end:function(){this.lastAngle=void 0;c.superclass.end.apply(this,arguments)},fireEnd:function(a){i.fire(this.target,"rotateEnd",e.mix(a,{touches:this.lastTouches}))}});f=new c;g.rotateEnd=g.rotateStart={handle:f};g.rotate={handle:f,
setup:function(){i.on(this,"touchmove",h)},tearDown:function(){i.detach(this,"touchmove",h)}};return c});
KISSY.add("event/dom/touch/handle","dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(","),function(e,a){function c(a){return e.startsWith(a,"touch")}function h(a){return e.startsWith(a,"mouse")}function g(a){return e.startsWith(a,"MSPointer")||e.startsWith(a,"pointer")}function i(a){this.doc=a;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var f=a("dom"),k=a("./handle-map"),d=a("event/dom/base");a("./tap");a("./swipe");a("./double-tap");
a("./pinch");a("./tap-hold");a("./rotate");var l=e.guid("touch-handle"),b=e.Features,n,p,o;if(b.isTouchEventSupported())if(e.UA.ios){o="touchend touchcancel";n="touchstart";p="touchmove"}else{o="touchend touchcancel mouseup";n="touchstart mousedown";p="touchmove mousemove"}else if(b.isPointerSupported()){n="pointerdown";p="pointermove";o="pointerup pointercancel"}else if(b.isMsPointerSupported()){n="MSPointerDown";p="MSPointerMove";o="MSPointerUp MSPointerCancel"}else{n="mousedown";p="mousemove";
o="mouseup"}i.prototype={constructor:i,lastTouches:[],firstTouch:null,init:function(){var a=this.doc;d.on(a,n,this.onTouchStart,this);if(!g(p))d.on(a,p,this.onTouchMove,this);d.on(a,o,this.onTouchEnd,this)},addTouch:function(a){a.identifier=a.pointerId;this.touches.push(a)},removeTouch:function(a){for(var m=0,c=a.pointerId,b=this.touches,d=b.length;m<d;m++){a=b[m];if(a.pointerId===c){b.splice(m,1);break}}},updateTouch:function(a){for(var c=0,j,b=a.pointerId,d=this.touches,e=d.length;c<e;c++){j=d[c];
j.pointerId===b&&(d[c]=a)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var c=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var b={x:a.clientX,y:a.clientY};c.push(b);setTimeout(function(){var a=c.indexOf(b);a>-1&&c.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var c=
this.lastTouches,b=a.clientX,a=a.clientY,d=0,e=c.length,f;d<e&&(f=c[d]);d++){var g=Math.abs(b-f.x),h=Math.abs(a-f.y);if(g<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,j;if(c(b)){j=b==="touchend"||b==="touchcancel"?a.changedTouches:a.touches;if(j.length===1){a.which=1;a.pageX=j[0].pageX;a.pageY=j[0].pageY}return a}j=this.touches;b=!b.match(/(up|cancel)$/i);a.touches=b?j:[];a.targetTouches=b?j:[];a.changedTouches=j;return a},onTouchStart:function(a){var b,j;j=a.type;var e=this.eventHandle;
if(c(j)){this.setPrimaryTouch(a.changedTouches[0]);this.dupMouse(a)}else if(h(j)){if(this.isEventSimulatedFromTouch(a))return;this.touches=[a.originalEvent]}else if(g(j)){this.addTouch(a.originalEvent);if(this.touches.length===1)d.on(this.doc,p,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+a.type);for(b in e){j=e[b].handle;j.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){var b=a.type;if(h(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=
[a.originalEvent]}else if(g(b))this.updateTouch(a.originalEvent);else if(!c(b))throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){var b=this,j=a.type;if(!h(j)||!b.isEventSimulatedFromTouch(a)){b.callEventHandle("onTouchEnd",a);if(c(j)){b.dupMouse(a);e.makeArray(a.changedTouches).forEach(function(a){b.removePrimaryTouch(a)})}else if(h(j))b.touches=[];else if(g(j)){b.removeTouch(a.originalEvent);b.touches.length||d.detach(b.doc,p,b.onTouchMove,
b)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);if(b.changedTouches.length){for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,c=k[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc;
d.detach(a,n,this.onTouchStart,this);d.detach(a,p,this.onTouchMove,this);d.detach(a,o,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);d||f.data(c,l,d=new i(c));b&&d.addEventHandle(b)},removeDocumentHandle:function(a,b){var c=f.getDocument(a),d=f.data(c,l);if(d){b&&d.removeEventHandle(b);if(e.isEmptyObject(d.eventHandle)){d.destroy();f.removeData(c,l)}}}}});
KISSY.add("event/dom/touch",["event/dom/base","./touch/handle-map","./touch/handle"],function(e,a){function c(a){d.addDocumentHandle(this,a);k[a].setup.apply(this,arguments)}function h(a){d.removeDocumentHandle(this,a);k[a].tearDown.apply(this,arguments)}function g(a){d.addDocumentHandle(this,a)}function i(a){d.removeDocumentHandle(this,a)}var f=a("event/dom/base"),k=a("./touch/handle-map"),d=a("./touch/handle"),l=f.Gesture,b=l.start="KSPointerDown",n=l.move="KSPointerMove",p=l.end="KSPointerUp";
l.tap="tap";l.doubleTap="doubleTap";k[b]={handle:{isActive:1,onTouchStart:function(a){f.fire(a.target,b,a)}}};k[n]={handle:{isActive:1,onTouchMove:function(a){f.fire(a.target,n,a)}}};k[p]={handle:{isActive:1,onTouchEnd:function(a){f.fire(a.target,p,a)}}};var l=f.Special,o,q,m;for(q in k)o={},m=k[q],o.setup=m.setup?c:g,o.tearDown=m.tearDown?h:i,m.add&&(o.add=m.add),m.remove&&(o.remove=m.remove),l[q]=o});
