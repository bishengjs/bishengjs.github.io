/*! BiSheng.js 2014-01-23 11:14:34 AM CST */

!function(a){function b(a,b,c,d){var e=arguments.length,f=[];switch(e){case 1:c=a,a=b=d=void 0;break;case 2:c=a,d=b,a=b=void 0;break;case 3:d=c,c=b,a instanceof Array?(b=a,a=void 0):b=void 0}"object"==typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?(void 0!==a&&f.push(a),a!==b&&f.push(b),f.push(c),define.apply(window,f)):"function"==typeof define&&define.cmd?(void 0!==a&&f.push(a),a!==b&&f.push(b),f.push(c),define.apply(window,f)):"undefined"!=typeof KISSY?(window.define=function(a,b,c){KISSY.add(a,function(){var a=[].slice,b=a.call(arguments,1,arguments.length-1);return c.apply(window,b)},{requires:b})},window.define.kmd={},define(a,b,c)):d&&d()}b("bisheng",["jquery","handlebars"],a,function(){window.BiSheng=a()})}(function(){function a(a){return void 0===a?d:(d=!!a,d?c=setTimeout(b,50):clearTimeout(c),void 0)}function b(){clearTimeout(c);for(var a=0;a<e.length;a++)e[a]&&e[a]();d&&(c=setTimeout(b,50))}var c,d=!1,e=[];e.__index=0,d&&(c=setTimeout(b,50));var f=function(){function c(a,b,c){function d(){var d=g(a,i,c?[h]:[],c);d&&d.length&&(b(d,a,i),i=f(a,c,[h]))}var h=k++,i=f(a,c,[h]);return d.data=a,d.callback=b,b&&b.tpl&&(d.tpl=b.tpl),e.push(d),i}function d(a,b){function c(a){for(var b=0;b<e.length;b++)a(e[b])&&(b<e.__index&&e.__index--,e.splice(b--,1))}a&&"function"==typeof b&&c(function(c){return c.callback===b&&c.data===a}),("function"==typeof a||!a&&"function"==typeof b)&&(b=a||b,c(function(a){return a.callback===b||a.callback.guid&&a.callback.guid===b.guid})),void 0!==a&&c(function(b){return b.data===a})}function f(a,b,c){var d,e,g=a.constructor();if(c=c||[],null===a||"object"!=typeof a)return a;b&&(g.$path=c.join("."));for(d in a)e=a[d],void 0!==e&&null!==e&&(e.constructor===Object||e.constructor===Array?e=f(e,b,c.concat(d)):b&&(e=new Object(e),e.$path=c.concat(d).join("."))),g[d]=e;return g}function g(a,b,c,d){function e(a,b){return function(){for(var c=a,d=1;d<b.length-1;d++)c=c[b[d]];return c}}var f=f||[];if(c=c||[],("object"!=typeof a||"object"!=typeof b)&&f.length)return f;if(h(a,b,c,f),i(a,b,c,f),j(a,b,c,f),d)for(var g,k=0;k<f.length;k++)g=f[k],g.root=a,g.context=e(a,g.path)(),g.getContext=e;return f.length?f:void 0}function h(a,b,c,d,e){var f,g;for(f in a)/\$guid|\$path|\$blocks|\$helpers/.test(f)||(g=a[f],f in b?void 0!==g&&null!==g&&void 0!==b[f]&&null!==b[f]&&g.constructor===b[f].constructor&&(g.constructor===Object||g.constructor===Array)&&h(g,b[f],c.concat(f),d,e):d.push(e?{type:e,path:c.concat(f),value:void 0,oldValue:a[f]}:{type:l.ADD,path:c.concat(f),value:a[f]}));return d.length?d:void 0}function i(a,b,c,d){return h(b,a,c,d,l.DELETE)}function j(a,b,c,d){var e,f;for(e in a)/\$guid|\$path|\$blocks|\$helpers/.test(e)||(f=a[e],e in b&&(void 0!==f||void 0!==b[e])&&(void 0!==f&&null!==f&&void 0!==b[e]&&null!==b[e]&&f.constructor===b[e].constructor?f.constructor!==Object&&f.constructor!==Array?f.valueOf()!==b[e].valueOf()&&d.push({type:l.UPDATE,path:c.concat(e),value:f,oldValue:b[e]}):j(f,b[e],c.concat(e),d):d.push({type:l.UPDATE,path:c.concat(e),value:f,oldValue:void 0!==b[e]?b[e].valueOf():b[e]})));return d.length?d:void 0}var k=1,l={ADD:"add",DELETE:"delete",UPDATE:"update"};return{auto:a,tasks:e,TYPES:l,watch:c,unwatch:d,clone:f,diff:g,letMeSee:b}}();window.JSON||(window.JSON={stringify:function(a){var b,c=[];for(var d in a)b="string"==typeof a[d]?'"'+a[d]+'"':a[d],c.push('"'+d+'":'+b);return"{"+c.join(",")+"}"}});var g={create:function(a){var b=Handlebars.Utils.escapeExpression,c=b("<script");for(var d in a)void 0!==a[d]&&(c+=" "+d+b('="')+a[d]+b('"'));return c+=b("></script>")},getLocatorRegExp:function(){return/(<script(?:.*?)><\/script>)/gi},find:function(a,b){var c="script";for(var d in a)c+="["+d+'="'+a[d]+'"]';return jQuery(c,b)},parse:function(a,b){return jQuery(a).attr(b)},update:function(a,b,c){if("script"===a.nodeName.toLowerCase()&&a.getAttribute("guid")&&"start"===a.getAttribute("slot")&&(c||!a.getAttribute("type")))for(var d in b)jQuery(a).attr(d,b[d]);return a},parseTarget:function(a){for(var b,c=jQuery(a).attr("guid"),d=[],e=a;e=e.nextSibling;)if(b=jQuery(e),"script"===e.nodeName.toLowerCase()&&b.attr("guid")){if(b.attr("guid")===c&&"end"===b.attr("slot"))break}else d.push(e);return jQuery(d)}},h={create:function(a){var b=Handlebars.Utils.escapeExpression;return b("<!-- ")+b(JSON.stringify(a))+b(" -->")},getLocatorRegExp:function(){return/(<!--\s*({(?:.*?)})\s*-->)/gi},find:function(a,b){return jQuery(b).add("*",b).contents().filter(function(){return 8===this.nodeType}).filter(function(b,c){try{var d=new Function("return "+c.nodeValue)();for(var e in a)if(a[e]!==d[e])return!1;return!0}catch(f){return!1}})},parse:function(a,b){var c=new Function("return "+a.nodeValue)();return b?c[b]:c},update:function(a,b,c){if(8===a.nodeType){var d=this.parse(a);if(d.guid&&"start"===d.slot&&(c||!d.type)){for(var e in b)d[e]=b[e];a.nodeValue=" "+JSON.stringify(d)+" "}}return a},parseTarget:function(a){for(var b=this.parse(a),c=[],d=a;d=d.nextSibling;)if(8===d.nodeType){var e=this.parse(d);if(e.guid===b.guid&&"end"===e.slot)break}else c.push(d);return jQuery(c)}},i=[g,h],j=-1!==location.search.indexOf("locator=script")?g:-1!==location.search.indexOf("locator=comment")?h:i[0],k=function(){var a=1,b=Handlebars.helpers["if"];Handlebars.registerHelper("if",function(a,c){return b.call(this,void 0!==a?a.valueOf():a,c)});var c=Handlebars.helpers.blockHelperMissing;return Handlebars.registerHelper("blockHelperMissing",function(a,b){return c.call(this,void 0!==a&&null!==a?a.valueOf():a,b)}),Handlebars.registerHelper("$lastest",function(a){return a&&a.$path||this&&this.$path}),{handle:function(a,b,c,d,e){return 2===arguments.length&&(d=b,b=void 0,e={}),3===arguments.length&&(d=b,e=c,b=c=void 0),this[a.type]&&this[a.type](a,b,c,d,e),a},program:function(a,b,c,d,e){for(var f=0;f<a.statements.length;f++)this.handle(a.statements[f],a.statements,f,d,e)},mustache:function(b,c,d,e,f){if(!b.binded){var g=[];b.isHelper?b.params.forEach(function(a){"ID"===a.type&&g.push(a.string)}):g.push(b.id.string),g=g.join(" ");var h,i,k={guid:a,slot:"",type:"text",path:"{{$lastest "+g+"}}",isHelper:!!b.isHelper};k.slot="start",h=j.create(k),i=Handlebars.parse(h).statements,i[1].binded=!0,c.splice.apply(c,[d,0].concat(i)),h=j.create({guid:k.guid,slot:"end"}),i=Handlebars.parse(h).statements,c.splice.apply(c,[d+4,0].concat(i)),f&&(f[a]={constructor:Handlebars.AST.ProgramNode,type:"program",statements:[b]}),a++,b.binded=!0}},block:function(b,c,d,e,f){if(!b.binded){var g,h;0===b.mustache.params.length?(g="",h=b.mustache.id.string):(g=b.mustache.id.string,h=b.mustache.params[0].string);var i,k,l={guid:a,slot:"",type:"block",path:"{{$lastest "+h+"}}",helper:g};l.slot="start",i=j.create(l),k=Handlebars.parse(i).statements,k[1].binded=!0,c.splice.apply(c,[d,0].concat(k)),i=j.create({guid:l.guid,slot:"end"}),k=Handlebars.parse(i).statements,c.splice.apply(c,[d+4,0].concat(k)),e&&(e[a]={constructor:Handlebars.AST.ProgramNode,type:"program",statements:[b]}),a++,b.binded=!0,this.handle(b.program||b.inverse,c,d,e,f)}}}}(),l=function(){function a(a,c){b(a),g(a,c)}function b(a){switch(a.nodeType){case 1:case 9:case 11:d(a),e(a);break;case 3:c(a)}}function c(a){var b=a.textContent||a.innerText||a.nodeValue;jQuery("<div>"+b+"</div>").contents().each(function(a,b){j.update(b,{type:"text"})}).replaceAll(a)}function d(a){var b=j.getLocatorRegExp(),c=/([^;]*?): ([^;]*)/gi,d=[];jQuery.each(function(){for(var b=[],c=a.attributes,d=0;d<c.length;d++)(c[d].specified||c[d].nodeValue)&&b.push(c[d]);return b}(),function(e,f){var g,h,i,l=f.nodeName,m=f.nodeValue;if(l=l.toLowerCase(),i=k[l],l=i?i.name:l,"style"===l)for(c.exec("");h=c.exec(m);)for(b.exec("");g=b.exec(h[2]);)d.push(j.update(jQuery("<div>"+g[1]+"</div>").contents()[0],{type:"attribute",name:l,css:jQuery.trim(h[1])},!0));else for(b.exec("");g=b.exec(m);)d.push(j.update(jQuery("<div>"+decodeURIComponent(g[1])+"</div>").contents()[0],{type:"attribute",name:l},!0));d.length&&(m=m.replace(b,""),f.nodeValue=m,jQuery(d).each(function(b,c){var d=j.parse(c,"slot");"start"===d&&jQuery(a).before(c),"end"===d&&jQuery(a).after(c)})),i&&i.teardown(a,m)})}function e(a){jQuery(a.childNodes).each(function(a,c){b(c)})}function g(a,b){j.find({slot:"start",type:"attribute",name:"value"},a).each(function(a,c){var d=j.parse(c,"path").split("."),e=j.parseTarget(c)[0];jQuery(e).on("change.bisheng keyup.bisheng",function(a){h(b,d,a.target),f.auto()||f.letMeSee()})}),j.find({slot:"start",type:"attribute",name:"checked"},a).each(function(a,c){for(var d=j.parse(c,"path").split("."),e=j.parseTarget(c)[0],g=b,h=1;h<d.length;h++)g=g[d[h]];(void 0===g||g.valueOf()===!1||"false"===g.valueOf())&&jQuery(e).prop("checked",!1),void 0===g||g.valueOf()!==!0&&"true"!==g.valueOf()&&"checked"!==g.valueOf()||jQuery(e).prop("checked",!0),jQuery(e).on("change.bisheng",function(a,c){c||"radio"!==a.target.type||jQuery('input:radio[name="'+a.target.name+'"]').not(a.target).trigger("change.bisheng",c=!0),i(b,d,a.target),f.auto()||f.letMeSee()})})}function h(a,b,c){for(var d=1;d<b.length-1;d++)a=a[b[d]];var e,f=jQuery(c);switch(c.nodeName.toLowerCase()){case"input":switch(c.type){case"text":f.data("user is editing",!0),e=f.val();break;case"radio":case"checkbox":return;default:e=f.val()}break;case"select":e=f.val();break;case"textarea":e=f.val();break;default:e=f.val()}a[b[b.length-1]]=e}function i(a,b,c){for(var d=1;d<b.length-1;d++)a=a[b[d]];var e,f,g=jQuery(c);switch(c.nodeName.toLowerCase()){case"input":switch(c.type){case"radio":e=g.prop("checked"),f=g.attr("name"),f&&e&&f in a&&(a[f]=g.val());break;case"checkbox":e=g.prop("checked")}}a[b[b.length-1]]=e}var k={"bs-style":{name:"style",setup:function(){},teardown:function(a,b){jQuery(a).attr("style",b)}},"bs-src":{name:"src",setup:function(){},teardown:function(a,b){jQuery(a).attr("src",b)}},"bs-checked":{name:"checked",setup:function(){},teardown:function(a,b){"true"===b&&jQuery(a).attr("checked","checked")}}};return{scan:a}}(),m=function(){function a(b,c,d,e){var f,g=j.find({slot:"start",path:c.path.join(".")},e||document.body);("delete"===c.type||"add"===c.type)&&c.context instanceof Array&&(c.path.pop(),c.type="update",c.context=c.getContext(c.root,c.path)(),a(b,c,d)),g.each(function(e,g){f=j.parse(g,"type"),a[f]&&a[f](g,b,c,d)})}function b(a){a.target.nodeType&&(a.target=[a.target]),a.target.forEach&&a.target.forEach(function(a){switch(a.nodeType){case 3:a.parentNode.scrollIntoView();break;case 1:a.scrollIntoView()}})}function c(a){a.target.nodeType&&(a.target=[a.target]),a.target.forEach&&a.target.forEach(function(a){switch(a.nodeType){case 3:jQuery(a).wrap("<span>").parent().addClass("transition highlight"),setTimeout(function(){jQuery(a).unwrap("<span>").removeClass("transition highlight")},500);break;case 1:jQuery(a).addClass("transition highlight"),setTimeout(function(){jQuery(a).removeClass("transition highlight")},500)}})}return a.text=function(a,b,c,d){var e,f=j.parse(a,"guid"),g=j.parse(a,"helper"),h=j.parseTarget(a);1===h.length&&3===h[0].nodeType?(b.target.push(h[0]),h[0].nodeValue=c.value):(e="true"===g?Handlebars.compile(d.$helpers[f])(c.context):c.value,n.convert(e).contents().insertAfter(a).each(function(a,c){b.target.push(c)}),jQuery(h).remove())},a.attribute=function(a,b,c,d){var e,g,h;b.target.push(e=j.parseTarget(a)[0]),h=jQuery(e);var i=d.$blocks[j.parse(a,"guid")],k=i?Handlebars.compile(i)(c.context):c.value,l=function(){var a,b=f.clone(c.context,!0,c.path.slice(0,-1));return b[c.path[c.path.length-1]]=void 0!==c.oldValue?c.oldValue.valueOf():c.oldValue,a=i?Handlebars.compile(i)(b):c.oldValue}();switch(g=j.parse(a,"name")){case"class":h.removeClass(""+l).addClass(""+k);break;case"bs-style":case"style":h.css(j.parse(a,"css"),k);break;case"value":h.val()===k||h.data("user is editing")||h.val(k),h.data("user is editing",!1);break;case"checked":h.prop(g,k),g=h.attr("name"),g&&h.prop("checked")&&g in c.context&&(c.context[g]=h.val());break;default:h.attr(g,function(a,b){return void 0===l?k:b!==l.valueOf()?b.replace(l,k):k})}},a.block=function(a,b,c,d){var e=j.parse(a,"guid"),g=d.$blocks[e],h=f.clone(c.context,!0,c.path.slice(0,-1)),i=Handlebars.compile(g)(h);i=n.convert(i),l.scan(i[0],c.context),i=i.contents();var k=j.parseTarget(a),m=k.length?k[k.length-1].nextSibling:a.nextSibling;return 0===i.length?(jQuery(k).remove(),void 0):(i.length<k.length&&jQuery(k.splice(i.length,k.length-i.length)).remove(),i.each(function(a,c){return k[a]?c.nodeType!==k[a].nodeType?(k[a].parentNode.insertBefore(c,k[a]),k[a].parentNode.removeChild(k[a]),b.target.push(c),void 0):3===c.nodeType&&c.nodeValue!==k[a].nodeValue?(k[a].nodeValue=c.nodeValue,void 0):8===c.nodeType&&c.nodeValue!==k[a].nodeValue?(k[a].nodeValue=c.nodeValue,void 0):1===c.nodeType&&c.outerHTML!==k[a].outerHTML?(k[a].parentNode.insertBefore(c,k[a]),k[a].parentNode.removeChild(k[a]),b.target.push(c),void 0):void 0:(m.parentNode.insertBefore(c,m),b.target.push(c),void 0)}),void 0)},{handle:a,scrollIntoView:b,highlight:c}}(),n={},o=/<([\w:]+)/,p={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]};p.optgroup=p.option,p.tbody=p.tfoot=p.colgroup=p.caption=p.thead,p.th=p.td,n.wrap=function(){},n.convert=function(a){var b=(o.exec(a)||["",""])[1].toLowerCase(),c=p[b]||p._default,d=c[0],e=document.createElement("div");for(e.innerHTML=c[1]+a+c[2];d--;)e=e.lastChild;return jQuery(e)},n.table=function(a){return a.replace(/(<table.*?>)([\w\W]*?)(<\/table>)/g,function(a){return a.replace(/(>)([\w\W]*?)(<)/g,function(a,b,c,d){if(c.indexOf("&lt;")>-1){var e="";return n.convert(c).contents().each(function(a,b){e+=b.nodeValue}),b+e+d}return b+c+d})})};var q=function(){var a=1;return{version:"0.1.0",auto:function(a){return arguments.length?(f.auto(a),this):f.auto()},bind:function(a,b,c,d){function e(b){jQuery.each(b,function(b,c){var e={target:[]};m.handle(e,c,g,d),location.href.indexOf("scrollIntoView")>-1&&m.scrollIntoView(e,a),location.href.indexOf("highlight")>-1&&m.highlight(e,a)})}e.tpl=b;var g=f.watch(a,e,!0,!0);b=b.replace(/(<.*?)(style)(=.*?>)/g,"$1bs-style$3").replace(/(<input.*?)(checked)(=.*?>)/g,"$1bs-checked$3").replace(/(<img.*?)(src)(=.*?>)/g,"$1bs-src$3");var h=Handlebars.parse(b);k.handle(h,void 0,void 0,g.$blocks={},g.$helpers={});var i=Handlebars.compile(h),j=i(g);j=n.table(j);var o=jQuery(n.convert(j));return o.length&&l.scan(o[0],a),o=o.contents().get(),c?c.call(a,o)||o:o},unbind:function(a,b){if(b)for(var c,d=0;d<f.tasks.length;d++)c=f.tasks[d],c.data===a&&c.tpl===b&&f.tasks.splice(d--,1);else f.unwatch(a);return this},watch:function(b,c,d){function e(a){for(var b=a.length;b>0;b--)if(j[a.slice(0,b).join(".")])return!0}function g(a){for(var c=0;c<a.length;c++)i=a[c],e(i.path)&&d.call(b,i)}var h,i,j={};if(c&&3===arguments.length){for(c=c.constructor!==Array?[c]:c,h=0;h<c.length;h++)j[c[h]]=!0;d.guid=d.guid||a++,g.guid=d.guid,g.properties=c,f.watch(b,g)}else d=c||d,d.guid=d.guid||a++,f.watch(b,d);return this},unwatch:function(a,b,c){if(!a)return this;if(1===arguments.length&&"function"==typeof a&&(c=a,a=b=void 0),2===arguments.length&&"function"==typeof b&&(c=b,b=void 0),!b)return f.unwatch(a,c),this;var d,e,g,h,i=!1,j=[];for(j=b.constructor!==Array?[b]:b,d=0;d<f.tasks.length;d++)if(h=f.tasks[d],i=!1,h.data===a&&h.callback.properties&&(!c||h.callback.guid===c.guid)){for(e=0;e<j.length;e++)for(g=0;g<h.callback.properties.length;g++)h.callback.properties[g]===j[e]&&(h.callback.properties.splice(g--,1),h.callback.properties.length||(i=!0));i&&f.tasks.splice(d--,1)}return this},apply:function(a){return a(),q.Loop.letMeSee(),this}}}();return q.Loop=f,q.Locators=i,q.Locator=j,q.AST=k,q.Scanner=l,q.Flush=m,q});
//# sourceMappingURL=dist/bisheng-min.map